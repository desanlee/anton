<% if @selectsut != nil then %>
	<% if @current_user.lead? then %>
		<h2>SUT Assignment</h2><hr>
		<div class="span10">This Server belongs to <%= User.find_by_id(Sut.find_by_id(@selectsut).holder_id).email %> currently</div>
		<div class="span10"></div>
		<%= form_tag controller: "sysconfigs", action: "selectuser" do %>
			<%= hidden_field_tag(:selectsut, @selectsut) %>
			<div class="span">Assign SUT to: <%= select_tag 'selectuser', options_from_collection_for_select( @users, :id, :email) %></div>
			<div class="toright"><%= submit_tag "OK" , :class => "submit btn btn-primary btn-success" %></div>
		<% end %>
		<hr><br>
	<% end %>

	<h2>Current Config Has Following Hardwares</h2><hr>

	<% if Execution.find_by_sysconfig_id(@currentsysconfig.id) then @editable = true else @editable = false end %>
	
	<table class="table table-striped table-bordered table-condensed">
		<% if @currentsysconfig.devices.count != 0 then %>
			<% @currentsysconfig.devices.each do |d| %>
				<% if d.devicetype.devicecate == "Hardware" then %><tr>
					<td><%= d.name %></td>
					<td>Position is:<%= Sysconfigrelationship.find_by_sysconfig_id_and_device_id(@currentsysconfig,d.id).position %></td> 
					<td><%= link_to "delete", Sysconfigrelationship.find_by_sysconfig_id_and_device_id(@currentsysconfig,d.id), method: :delete, data: { confirm: "Sure?" }, class: "toright" if @editable %></td>
				</tr><% end %>
			<% end %>
		<% else %>
			<h2><br>No devices existed in current config</h2>
		<% end %>
	</table>

	<% if @editable then %>
		<hr>
		<%= form_tag controller: "sysconfigs", action: "selecttype" do %>
			<%= hidden_field_tag(:devicetype, @selecttype) %>
			<%= hidden_field_tag(:selectsut, @selectsut) %>
			<div class="span11">
				<div><%= select_tag 'selecttype', options_from_collection_for_select( @devicetypes, :id, :name, @selecttype), onchange: "this.form.submit();"  %></div>
			</div>
		<% end %>

		<%= form_tag controller: "sysconfigs", action: "adddevice" do %>
			<%= hidden_field_tag(:selecttype, @selecttype) %>
			<%= hidden_field_tag(:selectsut, @selectsut) %>
			<%= hidden_field_tag(:currentsysconfig_id, @currentsysconfig.id) %>
			<div class="span10">
				<div><%= select_tag 'selectdevice', options_from_collection_for_select( @devices, :id, :name) %></div>
				<div><%= text_field_tag :deviceposition, "Position", class: "textsize4" %></div>
			</div>
			<div class="toright"><%= submit_tag "Add Devices" , :class => "submit btn btn-primary btn-danger" %></div>
		<% end %>
	<% else %>
		<%= form_tag controller: "sysconfigs", action: "newconfig" do %>
			<%= hidden_field_tag(:selecttype, @selecttype) %>
			<%= hidden_field_tag(:selectsut, @selectsut) %>
			<%= hidden_field_tag(:currentsysconfig_id, @currentsysconfig.id) %>
			<div class="toright"><%= submit_tag "Change Config" , :class => "submit btn btn-large btn-danger" %></div>
		<% end %>
	<% end %>
	
	<br><hr><h2>Config History For Selected SUT</h2><hr>

	<ul>
		<% if @sysconfiglist != nil then %>
			<% if @sysconfiglist.count != 0 then %>
				<% @sysconfiglist.each do |d| %>
					<li>
						<div class="span4"><%= d.created_at %></div>
						<div class="span4">by:<%= d.user.email if d.user != nil %></div> 
					</li>
				<% end %>
			<% else %>
				<h2><br>No configs existed for selected SUT</h2>
			<% end %>
		<% end %>	
	</ul>
	
<% else %>
	<h2>Select or select SUT first</h2>
<% end %>
