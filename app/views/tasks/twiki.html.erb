<% index=1 %>

---+ !<%= @task.name %> SQA Test Plan & Result<br>

%TOC%<br>

---++ <%= index %>. Hight Lights<br>---<br>
<% index = index + 1 %>
&nbsp;&nbsp;&nbsp;NA<br>

---++ <%= index %>. Background<br>---<br>
<% index = index + 1 %>
&nbsp;&nbsp;&nbsp;NA<br>

---++ <%= index %>. Objects For Test Tasks.<br>---<br>
<% index = index + 1 %>

| Test Objects | Note |<br>
<% @taskobjects.each do |o| %>
	| <%= o.device.name%> | <%= o.device.note %>|<br>
<% end %><br>


<!-- Draw tables -->

<% @targetlist.each do |target| %>
	<% targetenv = target.targetenvs.first %>
	<% thematrix = targetenv.targetmatrixes %>
						
---++ <%= index %>. <%= target.name %><br>---<br>
<% index = index + 1 %>

<!-- First line is testcase list -->
	| * Devices Under Test * | * Environment Devices * |
	<% targetenv.testcases.each do |c| %>
		* <%= c.name %> * |
	<% end %><br>

<!-- Draw line of Device under test -->				
	<% targetenv.devices.each do |d| %>
		| *<%= d.name %>* | * * | 
		<% targetenv.testcases.each do |c| %>
			&nbsp;|
		<% end %><br>

	<!-- Draw line of Device as Environment -->	
		<% targetenv.depdevices.sort_by{|d| d[:devicetype_id]}.each do |dep| %>
			|* *|
			*<%= dep.name %>*|
			<% targetenv.testcases.each do |c| %>
				<% currentexecutions = thematrix.select { |mx| mx.device_id == d.id and mx.envdevice_id == dep.id and mx.testcase_id == c.id } %>
				<% if currentexecutions.count != 0 then %>
					<% currentexecutions.each do |em| %>
						<% if em.execution != nil then %>
							<% if em.execution.result == "fail" then %>
								<%= em.execution.sysconfig.sutname%> %RED%FAIL (CR:<%= em.execution.bug %>)%ENDCOLOR%&lt;br&gt; 
							<% else %>
								<%= em.execution.sysconfig.sutname%> <%=%>%GREEN%PASS%ENDCOLOR%&lt;br&gt;
							<% end %>
						<% end %>
					<% end %>
				<% end %>
				&nbsp;|
			<% end %> <br>
		<% end %>
	<% end %>
<% end %>	

---++ <%= index %>. System Configuration List<br>---<br>
<% index = index + 1 %>

<br>| * Config Name * | * Config Owner&lt;br&gt;Creation Time * | * Conponents Inluded * |<br>
<% @sysconfiglist.each do |sc| %>
| 
<%= sc.sutname %> 
|
<%= sc.user.email if sc.user != nil %>&lt;br&gt;<%= sc.created_at.to_date.to_s %> 
| 
<% if sc.current_hwc != nil then %>
	<% sc.current_hwc.each do |hwc| %>
		* <%= hwc.device.devicetype.name%> - <%= hwc.device.name %> 
		<% if hwc.position != nil then %>
			on <%= hwc.device.devicetype.positionname %><%= hwc.position %>
		<% end %>
		&lt;br&gt;
	<% end %>
<% end %>
|<br>
<% end %>