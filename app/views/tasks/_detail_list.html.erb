<h2>Task Objects - <%= @totalcases %>cases have been run
<div class="toright">
	<%= form_tag controller: "tasks", action: "calculate" do %>
		<%= hidden_field_tag(:selecttask, @selecttask) %>
		<%= hidden_field_tag(:selecttarget, @selecttarget) %>
		<div class="span3"><%= submit_tag "Status" , :class => "submit btn btn-large btn-danger" %></div>
	<% end %>
</div>	
</h2>

<% if @taskobjects != nil then %>
	<table class="table table-striped table-bordered table-condensed">
		<tr><td>Task Objects Name</td><td>Finish Status</td><td></td></tr>
		<% @taskobjects.each do |t| %>
			<tr><td><%= t.device.name %></td>
			<td>
			<%= t.device.realexecutions.count %>
			</td><td></td></tr>
		<% end %>
		<% if @devices != nil then %>
			<tr>
				<td>
					<%= form_tag controller: "tasks", action: "addtaskobject" do %>
						<%= hidden_field_tag(:selecttask, @selecttask) %>
						<%= hidden_field_tag(:selecttarget, @selecttarget) %>
						<div class="span"><%= select_tag 'taskobject', options_from_collection_for_select( @devices, :id, :name), :class => "textsize6" %></div>
						<div class="span"><%= submit_tag "+" , :class => "submit  btn btn-primary" %></div>
					<% end %>
				</td><td></td><td></td>
			</tr>
		<% end %>
	</table>	
<% else %>
	<div class="alarmtext center">No test targets existed!</div>
<% end %>

<!-- Draw tables for matrixes -->

<% if @targetenvlist != nil then %>
	<% if @target != nil then %>
	
<!-- Title of Matrix and Creation of new matrix -->
		<h2>
			<div>"<%= @target.name %>" Test Matrixes</div>
			<%= form_tag controller: "tasks", action: "addtagertenv" do %>
				<%= hidden_field_tag(:selecttask, @selecttask) %>
				<%= hidden_field_tag(:selecttarget, @selecttarget) %>
				<div class="span2 toright"><%= submit_tag "+ Matrix" , :class => "submit  btn btn-success" %></div>
			<% end %>
		</h2>

<!-- Draw tables -->		
		<% @targetenvlist.each do |t|%>
			<table class="table table-striped table-bordered table-condensed">
				<% @colum = 0 %>
				<tr>
<!-- First line is testcase list -->
					<td class="textsize6"> <div class ="row">
						<div class="span8">
						<%= form_tag controller: "tasks", action: "addtestcase" do %>
							<%= hidden_field_tag(:selecttask, @selecttask) %>
							<%= hidden_field_tag(:selecttarget, @selecttarget) %>
							<%= hidden_field_tag(:selecttargetenv, t.id) %>
							<div class="span"><%= select_tag 'selecttestcase', options_from_collection_for_select( @testcases, :id, :name), :class => "textsize4", onchange: "this.form.submit();"  %></div>
						<% end %>
						</div><div class="span8">
						<%= form_tag controller: "tasks", action: "adddevice" do %>
							<%= hidden_field_tag(:selecttask, @selecttask) %>
							<%= hidden_field_tag(:selecttarget, @selecttarget) %>
							<%= hidden_field_tag(:selecttargetenv, t.id) %>
							<div class="span"><%= select_tag 'selectdevice', options_from_collection_for_select( @devices, :id, :name), :class => "textsize4", onchange: "this.form.submit();" if @devices != nil %></div>
						<% end %>
						</div></div>
					</td>
					<% t.targetcaserelationships.each do |c| %>
						<td><%= link_to c.testcase.name, c, method: :delete, data: { confirm: "Sure?" }, class: "" if current_user.lead? %></td>
						<% @colum = @colum + 1 %>
					<% end %>
				</tr>
				<% t.targetenvrelationships.each do |d| %>
					<tr>
						<td><%= link_to d.device.name, d, method: :delete, data: { confirm: "Sure?" }, class: "" if current_user.lead? %></td>
						<% thematrix = t.targetmatrixes %>
						<% t.targetcaserelationships.each do |c| %>
							<td>
<!-- test result will be filled here -->
								<% currentexecutions = thematrix.select { |mx| mx.device_id == d.device_id and  mx.testcase_id == c.testcase_id } %>
								<% if currentexecutions.count != 0 then %>
									<% currentexecutions.each do |m| %>
										<%= m.execution.result if m.execution != nil %>
									<% end %>
								<% else %>
									NR
								<% end %>
<!-- test result has been filled now -->
							</td>
						<% end %>
					</tr>
				<% end %>		
			</table>
		<% end %>
	<% else %>
			<div class="alarmtext center">Select A target first!</div>
	<% end %>
<% end %>
